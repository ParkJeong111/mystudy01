<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="member">

	<!-- 김채은 영역 시작  -->
	
	<!-- 김채은 영역 끝  -->


	<!-- 권세진 영역 시작  -->
	
	<!-- 권세진 영역 끝  -->
	
	
	<!-- 박정연 영역 시작  -->
		<!-- 예약내역 확인을위한 resultMap -->
	<resultMap type="rdto" id="myreservationResult">
       <id property="rnum" column="rnum"/>
           <result property="hname" column="hname"/>
           <result property="usedate" column="usedate"/>
           <result property="mid" column="mid"/>
           <result property="rmoney" column="rmoney"/>
           <association property="hostdto" column="hname" javaType="hdto">
             <id property="hnum" column="hnum"/>
                 <result property="haddr" column="haddr"/>
                 <result property="himage" column="himage"/>
           </association>
    </resultMap>
		<!-- 기본 예약내역 -->
	<select id="myreservation" parameterType="String" resultMap="myreservationResult">
	select r.hname, h.haddr, h.himage, to_char(r.usedate, 'mm-dd') usedate, r.rmoney 
	from host h, reservation r where h.hname = r.hname and r.mid=#{mid} and r.usedate >= to_char(sysdate) order by r.usedate desc
	</select>

		<!-- 고객정보 확인 -->
	<select id="myinfo" parameterType="String" resultType="mdto">
	select mid, mpwd, memail, mnickname, mphone, maddr1, maddr2 from member where mid=#{mid}
	</select>
		<!-- 고객정보 수정 -->
	<update id="myupdate" parameterType="mdto">
	update member set mpwd=#{mpwd}, memail=#{memail}, mnickname=#{mnickname}, mphone=#{mphone}, maddr1=#{maddr1}, maddr2=#{maddr2} where mid=#{mid}
	</update>
		<!-- 고객정보 확인을 위한 페이지 이동전 패스워드 체크 -->
	<select id = "pwdcheck" parameterType="mdto" resultType = "int">
	select count(mid) from member where mid = #{mid} and mpwd = #{mpwd}
	</select>
		<!-- 로그인을 위한 아이디, 비밀번호 체크 -->
	<select id="idcheck" parameterType="mdto" resultType="mdto">
	select mid, mnickname, mphone from member where mid=#{mid} and mpwd=#{mpwd}
	</select>
	<!-- 박정연 영역 끝  -->
	
	
	<!-- 주성중 영역 시작  -->

	<!-- 주성중 영역 끝  -->

	<!-- ==============================  회원가입  (재민) ============================== -->
	<insert id="addmember" parameterType="mdto">
		insert into member values(member_seq.nextVal, #{mname}, #{mid}, #{mpwd}, #{mnickname},
		#{mphone}, #{memail}, #{maddr1}, #{maddr2}, #{mbirth}, #{msex}, null, sysdate, null, 0)
	</insert>
	<!-- id 중복 확인 -->
	<select id="idchk" parameterType="String" resultType="int">
		select count(*) mnum from member 
		where mid = #{mid}
	</select>

  </mapper>